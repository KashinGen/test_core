# –ì–ª—É–±–æ–∫–∏–π –∞–Ω–∞–ª–∏–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π –≤ core_rg

## üìã –û–±–∑–æ—Ä –∏–∑–º–µ–Ω–µ–Ω–∏–π

### –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
- **–ù–æ–≤—ã—Ö —Ñ–∞–π–ª–æ–≤:** ~15
- **–ò–∑–º–µ–Ω–µ–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤:** ~12
- **–ù–æ–≤—ã—Ö –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π:** 1 (`jsonwebtoken`, `@types/jsonwebtoken`)
- **–ù–æ–≤—ã—Ö –º–æ–¥—É–ª–µ–π:** 1 (authorization)
- **–ù–æ–≤—ã—Ö –º–∏–≥—Ä–∞—Ü–∏–π:** 1

---

## üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è

### 1. –°–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏

#### 1.1. –î–≤—É—Ö—É—Ä–æ–≤–Ω–µ–≤–∞—è –∑–∞—â–∏—Ç–∞

**–£—Ä–æ–≤–µ–Ω—å 1: Gateway Auth Guard (Network-level)**
- **–§–∞–π–ª:** `src/presentation/guards/gateway-auth.guard.ts`
- **–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –ó–∞—â–∏—Ç–∞ –æ—Ç –≤–Ω–µ—à–Ω–∏—Ö –∑–∞–ø—Ä–æ—Å–æ–≤, –Ω–µ –ø—Ä–æ—à–µ–¥—à–∏—Ö —á–µ—Ä–µ–∑ gateway
- **–ú–µ—Ö–∞–Ω–∏–∑–º:** –ü—Ä–æ–≤–µ—Ä–∫–∞ shared secret (`GATEWAY_AUTH_TOKEN`)
- **–ó–∞–≥–æ–ª–æ–≤–∫–∏:** `x-gateway-auth` –∏–ª–∏ `integrationauthtoken`
- **–°—Ç–∞—Ç—É—Å:** ‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ, –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–æ –∫–∞–∫ `APP_GUARD`

**–£—Ä–æ–≤–µ–Ω—å 2: Role-based Authorization (Application-level)**
- **–§–∞–π–ª—ã:** 
  - `src/presentation/authorization/services/authorization.service.ts`
  - `src/presentation/authorization/services/jwt-extractor.service.ts`
  - `src/presentation/authorization/guards/roles.guard.ts`
- **–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø–∞ –Ω–∞ –æ—Å–Ω–æ–≤–µ —Ä–æ–ª–µ–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- **–ú–µ—Ö–∞–Ω–∏–∑–º:** –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ JWT –∏–∑ `Authorization: Bearer <token>`, –¥–µ–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏–µ, –ø—Ä–æ–≤–µ—Ä–∫–∞ —Ä–æ–ª–µ–π
- **–°—Ç–∞—Ç—É—Å:** ‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ, –Ω–æ –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≥–ª–æ–±–∞–ª—å–Ω–æ (—Ç–æ–ª—å–∫–æ –≤ handlers)

#### 1.2. –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –º–æ–¥—É–ª—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏

```
presentation/authorization/
‚îú‚îÄ‚îÄ roles.enum.ts                    # Enum –≤—Å–µ—Ö —Ä–æ–ª–µ–π –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã
‚îú‚îÄ‚îÄ interfaces/
‚îÇ   ‚îî‚îÄ‚îÄ request-user.interface.ts    # RequestUser { id, roles[] }
‚îú‚îÄ‚îÄ services/
‚îÇ   ‚îú‚îÄ‚îÄ jwt-extractor.service.ts     # –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏–∑ JWT
‚îÇ   ‚îî‚îÄ‚îÄ authorization.service.ts     # –ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø—Ä–∞–≤
‚îú‚îÄ‚îÄ guards/
‚îÇ   ‚îî‚îÄ‚îÄ roles.guard.ts               # Guard –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ä–æ–ª–µ–π (–Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è)
‚îî‚îÄ‚îÄ decorators/
    ‚îî‚îÄ‚îÄ require-roles.decorator.ts   # –î–µ–∫–æ—Ä–∞—Ç–æ—Ä @RequireRoles (–Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è)
```

**–û—Ü–µ–Ω–∫–∞ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã:** ‚≠ê‚≠ê‚≠ê‚≠ê (4/5)
- ‚úÖ –ß–µ—Ç–∫–æ–µ —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏
- ‚úÖ –ü–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ —Å–µ—Ä–≤–∏—Å—ã
- ‚ö†Ô∏è Guard –∏ –¥–µ–∫–æ—Ä–∞—Ç–æ—Ä —Å–æ–∑–¥–∞–Ω—ã, –Ω–æ –Ω–µ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è (–ø–æ—Ç–µ–Ω—Ü–∏–∞–ª –¥–ª—è —É–ª—É—á—à–µ–Ω–∏—è)

---

### 2. –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –≤ CQRS handlers

#### 2.1. –ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ Commands/Queries

**–ü–∞—Ç—Ç–µ—Ä–Ω:** –î–æ–±–∞–≤–ª–µ–Ω–∏–µ `requesterId` –∏ `requesterRoles` –≤ –∫–æ–º–∞–Ω–¥—ã/–∑–∞–ø—Ä–æ—Å—ã

**–ò–∑–º–µ–Ω–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã:**
- `src/application/commands/create-user.command.ts`
- `src/application/commands/update-account.command.ts`
- `src/application/commands/delete-account.command.ts`
- `src/application/queries/get-user-by-id.query.ts`
- `src/application/queries/get-accounts.query.ts`

**–ü—Ä–∏–º–µ—Ä:**
```typescript
export class CreateAccountCommand implements ICommand {
  constructor(
    // ... existing fields
    public readonly requesterId?: string,
    public readonly requesterRoles: string[] = [],
  ) {}
}
```

**–û—Ü–µ–Ω–∫–∞ –ø–æ–¥—Ö–æ–¥–∞:** ‚≠ê‚≠ê‚≠ê (3/5)
- ‚úÖ –Ø–≤–Ω–∞—è –ø–µ—Ä–µ–¥–∞—á–∞ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- ‚úÖ –õ–µ–≥–∫–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å (–º–æ–∂–Ω–æ –º–æ–∫–∏—Ä–æ–≤–∞—Ç—å requester)
- ‚ö†Ô∏è –ó–∞–≥—Ä—è–∑–Ω—è–µ—Ç —Å–∏–≥–Ω–∞—Ç—É—Ä—ã –∫–æ–º–∞–Ω–¥/–∑–∞–ø—Ä–æ—Å–æ–≤
- ‚ö†Ô∏è –î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –ª–æ–≥–∏–∫–∏ –ø—Ä–æ–≤–µ—Ä–∫–∏ –≤ –∫–∞–∂–¥–æ–º handler
- üí° **–ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞:** –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `@UseGuards(RolesGuard)` –Ω–∞ —É—Ä–æ–≤–Ω–µ –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–æ–≤

#### 2.2. –ü—Ä–æ–≤–µ—Ä–∫–∏ –≤ Handlers

**–†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ –ø—Ä–æ–≤–µ—Ä–∫–∏:**

1. **CreateAccountHandler**
   - ‚úÖ –¢—Ä–µ–±—É–µ—Ç `ROLE_PLATFORM_ACCOUNT_RW` –∏–ª–∏ `ROLE_PLATFORM_ADMIN`
   - ‚úÖ –ù–µ—Ç –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π –Ω–∞ –Ω–∞–∑–Ω–∞—á–∞–µ–º—ã–µ —Ä–æ–ª–∏ (–º–æ–∂–Ω–æ —Å–æ–∑–¥–∞—Ç—å –∞–¥–º–∏–Ω–∞)

2. **UpdateAccountHandler**
   - ‚úÖ –í–ª–∞–¥–µ–ª–µ—Ü –º–æ–∂–µ—Ç –æ–±–Ω–æ–≤–ª—è—Ç—å —Å–µ–±—è
   - ‚úÖ –í–ª–∞–¥–µ–ª–µ—Ü –ù–ï –º–æ–∂–µ—Ç –º–µ–Ω—è—Ç—å email –∏ roles
   - ‚úÖ –ê–¥–º–∏–Ω—ã –º–æ–≥—É—Ç –æ–±–Ω–æ–≤–ª—è—Ç—å –ª—é–±—ã–µ –∞–∫–∫–∞—É–Ω—Ç—ã
   - ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏—è –∞–∫–∫–∞—É–Ω—Ç–∞

3. **DeleteAccountHandler**
   - ‚úÖ –¢—Ä–µ–±—É–µ—Ç `ROLE_PLATFORM_ACCOUNT_RW` –∏–ª–∏ `ROLE_PLATFORM_ADMIN`
   - ‚úÖ –ó–∞–ø—Ä–µ—â–∞–µ—Ç —É–¥–∞–ª–µ–Ω–∏–µ —Å–µ–±—è

4. **GetUserByIdHandler**
   - ‚úÖ –í–ª–∞–¥–µ–ª–µ—Ü –º–æ–∂–µ—Ç —á–∏—Ç–∞—Ç—å —Å–µ–±—è
   - ‚úÖ –¢—Ä–µ–±—É–µ—Ç `ROLE_PLATFORM_ACCOUNT_RO` –¥–ª—è —á—Ç–µ–Ω–∏—è –¥—Ä—É–≥–∏—Ö

5. **GetAccountsHandler**
   - ‚úÖ –¢—Ä–µ–±—É–µ—Ç `ROLE_PLATFORM_ACCOUNT_RO` –∏–ª–∏ `ROLE_PLATFORM_ADMIN`

**–°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ Symfony Voter'–∞–º:** ‚úÖ 95%
- ‚úÖ –í—Å–µ –æ—Å–Ω–æ–≤–Ω—ã–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã
- ‚ö†Ô∏è –ù–µ—Ç –ø—Ä–æ–≤–µ—Ä–æ–∫ –Ω–∞ —É—Ä–æ–≤–Ω–µ Company/Employee (–Ω–æ —ç—Ç–æ –±—ã–ª–æ —É–ø—Ä–æ—â–µ–Ω–æ –ø–æ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—é)

---

### 3. –ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–∞—Ö

#### 3.1. CommandController

**–ò–∑–º–µ–Ω–µ–Ω–∏—è:**
- –î–æ–±–∞–≤–ª–µ–Ω `@Req() req: Request` –≤–æ –≤—Å–µ –º–µ—Ç–æ–¥—ã
- –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —á–µ—Ä–µ–∑ `authService.getUserFromRequest(req)`
- –ü–µ—Ä–µ–¥–∞—á–∞ `requesterId` –∏ `requesterRoles` –≤ –∫–æ–º–∞–Ω–¥—ã

**–ü—Ä–æ–±–ª–µ–º–∞:** ‚ö†Ô∏è –í—Å–µ –º–µ—Ç–æ–¥—ã —Ç—Ä–µ–±—É—é—Ç JWT, –¥–∞–∂–µ –ø—É–±–ª–∏—á–Ω—ã–µ (–Ω–∞–ø—Ä–∏–º–µ—Ä, `resetPassword`, `changePassword`)

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:** –î–æ–±–∞–≤–∏—Ç—å –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—É—é –ø—Ä–æ–≤–µ—Ä–∫—É –∏–ª–∏ –∏—Å–∫–ª—é—á–∏—Ç—å –ø—É–±–ª–∏—á–Ω—ã–µ endpoints

#### 3.2. QueryController

**–ò–∑–º–µ–Ω–µ–Ω–∏—è:**
- –ê–Ω–∞–ª–æ–≥–∏—á–Ω–æ CommandController
- –í—Å–µ –∑–∞–ø—Ä–æ—Å—ã —Ç—Ä–µ–±—É—é—Ç –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏

**–ü—Ä–æ–±–ª–µ–º–∞:** ‚ö†Ô∏è –ù–µ—Ç –ø—É–±–ª–∏—á–Ω—ã—Ö endpoints (–µ—Å–ª–∏ –æ–Ω–∏ –Ω—É–∂–Ω—ã)

---

### 4. Gateway –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è

#### 4.1. –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

**–§–∞–π–ª:** `gateway/amp-gateway/src/configs/static-gateway-config.ts`

**–ò–∑–º–µ–Ω–µ–Ω–∏–µ:**
```typescript
[AvailableExternalServices.CORE]: {
  host: configService.get(CORE_URL),
  authToken: configService.get(CORE_AUTH_TOKEN), // ‚Üê –î–æ–±–∞–≤–ª–µ–Ω–æ
  protocol: ClientProtocolEnum.HTTP,
  version: AvailableClientVersionEnum.DEFAULT,
},
```

**–°—Ç–∞—Ç—É—Å:** ‚úÖ Gateway –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–µ—Ä–µ–¥–∞–µ—Ç `authToken` –≤ –∑–∞–≥–æ–ª–æ–≤–∫–µ `integrationAuthToken`

#### 4.2. HttpClientHelper

**–ú–µ—Ö–∞–Ω–∏–∑–º:** 
- –ï—Å–ª–∏ –µ—Å—Ç—å `authToken` ‚Üí –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `integrationAuthToken` header
- –ï—Å–ª–∏ –Ω–µ—Ç ‚Üí –∏—Å–ø–æ–ª—å–∑—É–µ—Ç JWT –∏–∑ CLS (`Authorization: Bearer <token>`)

**–°—Ç–∞—Ç—É—Å:** ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ

---

## üîí –ê–Ω–∞–ª–∏–∑ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏

### 1. –°–∏–ª—å–Ω—ã–µ —Å—Ç–æ—Ä–æ–Ω—ã

‚úÖ **–î–≤—É—Ö—É—Ä–æ–≤–Ω–µ–≤–∞—è –∑–∞—â–∏—Ç–∞:**
- Network-level (Gateway Auth Guard)
- Application-level (Role-based checks)

‚úÖ **–ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∞–≤ –Ω–∞ —É—Ä–æ–≤–Ω–µ handlers:**
- –Ø–≤–Ω—ã–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ –≤ –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–µ
- –ó–∞—â–∏—Ç–∞ –æ—Ç privilege escalation (–≤–ª–∞–¥–µ–ª–µ—Ü –Ω–µ –º–æ–∂–µ—Ç –º–µ–Ω—è—Ç—å email/roles)

‚úÖ **JWT –¥–µ–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏–µ –±–µ–∑ –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏–∏:**
- –ö–æ—Ä—Ä–µ–∫—Ç–Ω–æ –¥–ª—è –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–≥–æ —Å–µ—Ä–≤–∏—Å–∞ (gateway —É–∂–µ –ø—Ä–æ–≤–µ—Ä–∏–ª —Ç–æ–∫–µ–Ω)
- –≠–∫–æ–Ω–æ–º–∏—Ç —Ä–µ—Å—É—Ä—Å—ã

### 2. –ü–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–µ —É—è–∑–≤–∏–º–æ—Å—Ç–∏

‚ö†Ô∏è **1. JWT –¥–µ–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏–µ –±–µ–∑ –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏–∏**
```typescript
const decoded = jwt.decode(token, { json: true }) as any;
```
**–†–∏—Å–∫:** –ï—Å–ª–∏ gateway –Ω–µ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç JWT, –º–æ–∂–Ω–æ –ø–æ–¥–¥–µ–ª–∞—Ç—å —Ç–æ–∫–µ–Ω
**–ú–∏—Ç–∏–≥–∞—Ü–∏—è:** Gateway –¥–æ–ª–∂–µ–Ω –ø—Ä–æ–≤–µ—Ä—è—Ç—å JWT –ø–µ—Ä–µ–¥ –æ—Ç–ø—Ä–∞–≤–∫–æ–π –≤ core_rg
**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:** –î–æ–±–∞–≤–∏—Ç—å –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—É—é –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—é JWT (–µ—Å–ª–∏ –Ω—É–∂–Ω–∞ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∑–∞—â–∏—Ç–∞)

‚ö†Ô∏è **2. –ù–µ—Ç rate limiting**
- –ó–∞—â–∏—Ç–∞ –æ—Ç brute force –Ω–∞ —É—Ä–æ–≤–Ω–µ gateway
- –ù–æ –≤ core_rg –Ω–µ—Ç –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–π –∑–∞—â–∏—Ç—ã

‚ö†Ô∏è **3. –ü—É–±–ª–∏—á–Ω—ã–µ endpoints —Ç—Ä–µ–±—É—é—Ç JWT**
- `POST /accounts/password/reset` - –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –ø—É–±–ª–∏—á–Ω—ã–º
- `POST /accounts/password/change` - –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –ø—É–±–ª–∏—á–Ω—ã–º (—Å —Ç–æ–∫–µ–Ω–æ–º —Å–±—Ä–æ—Å–∞)
- **–¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ:** –¢—Ä–µ–±—É—é—Ç JWT + gateway auth token
- **–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:** –ò—Å–∫–ª—é—á–∏—Ç—å —ç—Ç–∏ endpoints –∏–∑ –ø—Ä–æ–≤–µ—Ä–∫–∏ JWT

‚ö†Ô∏è **4. –ù–µ—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏ –Ω–∞ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏–µ –ø—Ä–∏–≤–∏–ª–µ–≥–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö —Ä–æ–ª–µ–π**
- –õ—é–±–æ–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å `ROLE_PLATFORM_ACCOUNT_RW` –º–æ–∂–µ—Ç —Å–æ–∑–¥–∞—Ç—å –∞–¥–º–∏–Ω–∞
- **–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:** –î–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É –≤ `CreateAccountHandler`:
  ```typescript
  const privilegedRoles = [Role.ROLE_PLATFORM_ADMIN, ...];
  if (command.roles.some(r => privilegedRoles.includes(r))) {
    requireAnyRole(requester, [Role.ROLE_PLATFORM_ADMIN]);
  }
  ```

‚ö†Ô∏è **5. –ù–µ—Ç –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è –ø–æ–ø—ã—Ç–æ–∫ –¥–æ—Å—Ç—É–ø–∞**
- –ù–µ—Ç –∞—É–¥–∏—Ç–∞ –Ω–µ—É–¥–∞—á–Ω—ã—Ö –ø–æ–ø—ã—Ç–æ–∫ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
- **–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:** –î–æ–±–∞–≤–∏—Ç—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ guards/handlers

---

## üîÑ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–π —Å–∏—Å—Ç–µ–º–æ–π

### 1. –°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å —Å Gateway

‚úÖ **–ü–æ–ª–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å:**
- –í—Å–µ endpoints —Å–æ–≤–ø–∞–¥–∞—é—Ç
- –§–æ—Ä–º–∞—Ç –¥–∞–Ω–Ω—ã—Ö (Hydra) –∏–¥–µ–Ω—Ç–∏—á–µ–Ω
- Query –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç—Å—è
- HTTP –º–µ—Ç–æ–¥—ã —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—Ç

‚úÖ **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –ø–µ—Ä–µ–¥–∞—á–∞ —Ç–æ–∫–µ–Ω–æ–≤:**
- Gateway –ø–µ—Ä–µ–¥–∞–µ—Ç `integrationAuthToken` header
- Gateway –ø–µ—Ä–µ–¥–∞–µ—Ç JWT –≤ `Authorization` header
- –í—Å–µ —Ä–∞–±–æ—Ç–∞–µ—Ç "–∏–∑ –∫–æ—Ä–æ–±–∫–∏"

### 2. –°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å —Å Adminpanel

‚úÖ **–ü–æ–ª–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å:**
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç —Ç–µ –∂–µ endpoints —á–µ—Ä–µ–∑ gateway
- –¢–µ –∂–µ DTO –∏ —Ñ–æ—Ä–º–∞—Ç—ã –æ—Ç–≤–µ—Ç–æ–≤
- –ù–∏–∫–∞–∫–∏—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–π –Ω–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è

### 3. –ú–∏–≥—Ä–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö

‚ö†Ô∏è **–ü—Ä–æ–±–ª–µ–º–∞:** –ù–µ—Ç –º–∏–≥—Ä–∞—Ü–∏–∏ –¥–∞–Ω–Ω—ã—Ö –∏–∑ —Å—Ç–∞—Ä–æ–≥–æ core
- –°—Ç–∞—Ä—ã–π core –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –æ–±—ã—á–Ω—É—é –ë–î (Doctrine ORM)
- –ù–æ–≤—ã–π core_rg –∏—Å–ø–æ–ª—å–∑—É–µ—Ç Event Store
- **–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:** –°–æ–∑–¥–∞—Ç—å —Å–∫—Ä–∏–ø—Ç –º–∏–≥—Ä–∞—Ü–∏–∏ –¥–∞–Ω–Ω—ã—Ö

---

## üìä –ö–∞—á–µ—Å—Ç–≤–æ –∫–æ–¥–∞

### 1. –°–∏–ª—å–Ω—ã–µ —Å—Ç–æ—Ä–æ–Ω—ã

‚úÖ **–ß–µ—Ç–∫–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞:**
- –†–∞–∑–¥–µ–ª–µ–Ω–∏–µ –Ω–∞ —Å–ª–æ–∏ (presentation, application, domain, infrastructure)
- –°–ª–µ–¥–æ–≤–∞–Ω–∏–µ CQRS –ø–∞—Ç—Ç–µ—Ä–Ω—É
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ DDD –ø—Ä–∏–Ω—Ü–∏–ø–æ–≤

‚úÖ **–¢–∏–ø–∏–∑–∞—Ü–∏—è:**
- TypeScript —Å —Å—Ç—Ä–æ–≥–∏–º–∏ —Ç–∏–ø–∞–º–∏
- Enum –¥–ª—è —Ä–æ–ª–µ–π
- –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã –¥–ª—è RequestUser

‚úÖ **–ü–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º–æ—Å—Ç—å:**
- AuthorizationService –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≤–µ–∑–¥–µ
- JwtExtractorService –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω

### 2. –ü—Ä–æ–±–ª–µ–º—ã –∏ —É–ª—É—á—à–µ–Ω–∏—è

‚ö†Ô∏è **1. –î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–¥–∞ –≤ handlers**
```typescript
// –ü–æ–≤—Ç–æ—Ä—è–µ—Ç—Å—è –≤ –∫–∞–∂–¥–æ–º handler:
const requester = {
  id: command.requesterId,
  roles: command.requesterRoles.filter((r): r is Role => ...),
};
```
**–†–µ—à–µ–Ω–∏–µ:** –í—ã–Ω–µ—Å—Ç–∏ –≤ helper –º–µ—Ç–æ–¥ –∏–ª–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å guard

‚ö†Ô∏è **2. –ù–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–π –∫–æ–¥**
- `RolesGuard` —Å–æ–∑–¥–∞–Ω, –Ω–æ –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è
- `@RequireRoles` –¥–µ–∫–æ—Ä–∞—Ç–æ—Ä –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è
- **–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:** –õ–∏–±–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å, –ª–∏–±–æ —É–¥–∞–ª–∏—Ç—å

‚ö†Ô∏è **3. –°—Ä–∞–≤–Ω–µ–Ω–∏–µ –º–∞—Å—Å–∏–≤–æ–≤ —á–µ—Ä–µ–∑ JSON.stringify**
```typescript
if (JSON.stringify(command.roles) !== JSON.stringify(user.roles)) {
```
**–ü—Ä–æ–±–ª–µ–º–∞:** –ù–µ —É—á–∏—Ç—ã–≤–∞–µ—Ç –ø–æ—Ä—è–¥–æ–∫ —ç–ª–µ–º–µ–Ω—Ç–æ–≤
**–†–µ—à–µ–Ω–∏–µ:** –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å deep equality check –∏–ª–∏ —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫—É

‚ö†Ô∏è **4. –ù–µ—Ç –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—à–∏–±–æ–∫ –≤ JwtExtractorService**
```typescript
} catch (error) {
  return null; // –¢–µ—Ä—è–µ—Ç—Å—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ–± –æ—à–∏–±–∫–µ
}
```
**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:** –õ–æ–≥–∏—Ä–æ–≤–∞—Ç—å –æ—à–∏–±–∫–∏ –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏

---

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ

‚ùå **–ù–µ—Ç —Ç–µ—Å—Ç–æ–≤ –¥–ª—è:**
- GatewayAuthGuard
- AuthorizationService
- JwtExtractorService
- –ü—Ä–æ–≤–µ—Ä–æ–∫ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –≤ handlers

### –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

1. **Unit —Ç–µ—Å—Ç—ã:**
   - AuthorizationService (–≤—Å–µ –º–µ—Ç–æ–¥—ã)
   - JwtExtractorService (—É—Å–ø–µ—à–Ω—ã–µ –∏ –Ω–µ—É—Å–ø–µ—à–Ω—ã–µ —Å–ª—É—á–∞–∏)
   - Handlers —Å –º–æ–∫–∞–º–∏ AuthorizationService

2. **Integration —Ç–µ—Å—Ç—ã:**
   - –ü–æ–ª–Ω—ã–π flow —Å–æ–∑–¥–∞–Ω–∏—è/–æ–±–Ω–æ–≤–ª–µ–Ω–∏—è/—É–¥–∞–ª–µ–Ω–∏—è —Å –ø—Ä–æ–≤–µ—Ä–∫–æ–π –ø—Ä–∞–≤
   - –¢–µ—Å—Ç—ã –Ω–∞ edge cases (self-update, self-delete)

3. **E2E —Ç–µ—Å—Ç—ã:**
   - –°–æ–∑–¥–∞–Ω–∏–µ –∞–¥–º–∏–Ω–∞ —á–µ—Ä–µ–∑ –º–∏–≥—Ä–∞—Ü–∏—é
   - –í—Ö–æ–¥ —á–µ—Ä–µ–∑ gateway
   - CRUD –æ–ø–µ—Ä–∞—Ü–∏–∏ —á–µ—Ä–µ–∑ API

---

## üöÄ –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

### –ê–Ω–∞–ª–∏–∑

‚úÖ **–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏:**
- JWT –¥–µ–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏–µ –±–µ–∑ –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏–∏ (–±—ã—Å—Ç—Ä–µ–µ)
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∞–≤ –≤ –ø–∞–º—è—Ç–∏ (–±—ã—Å—Ç—Ä–æ)

‚ö†Ô∏è **–ü–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã:**
- –ö–∞–∂–¥—ã–π –∑–∞–ø—Ä–æ—Å –¥–µ–∫–æ–¥–∏—Ä—É–µ—Ç JWT (–º–æ–∂–Ω–æ –∫–µ—à–∏—Ä–æ–≤–∞—Ç—å)
- –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è —Ä–æ–ª–µ–π –Ω–∞ –∫–∞–∂–¥–æ–º –∑–∞–ø—Ä–æ—Å–µ (–º–∏–Ω–∏–º–∞–ª—å–Ω—ã–π overhead)

**–û—Ü–µ–Ω–∫–∞:** ‚≠ê‚≠ê‚≠ê‚≠ê (4/5) - –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å —Ö–æ—Ä–æ—à–∞—è

---

## üìù –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

### –¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ

‚úÖ **–•–æ—Ä–æ—à–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è:**
- README.md –æ–±–Ω–æ–≤–ª–µ–Ω
- SETUP.md —Å–æ–¥–µ—Ä–∂–∏—Ç –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏
- scripts/README.md —Å –ø—Ä–∏–º–µ—Ä–∞–º–∏
- –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –≤ –∫–æ–¥–µ

‚ö†Ô∏è **–ù–µ —Ö–≤–∞—Ç–∞–µ—Ç:**
- API –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ (Swagger)
- –î–∏–∞–≥—Ä–∞–º–º—ã –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã
- –û–ø–∏—Å–∞–Ω–∏–µ flow –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏

---

## üéØ –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–∞–º

### –ö—Ä–∏—Ç–∏—á–Ω—ã–µ (—Å–¥–µ–ª–∞—Ç—å —Å—Ä–∞–∑—É)

1. **–ò—Å–∫–ª—é—á–∏—Ç—å –ø—É–±–ª–∏—á–Ω—ã–µ endpoints –∏–∑ JWT –ø—Ä–æ–≤–µ—Ä–∫–∏**
   - `POST /accounts/password/reset`
   - `POST /accounts/password/change`

2. **–î–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É –Ω–∞ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏–µ –ø—Ä–∏–≤–∏–ª–µ–≥–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö —Ä–æ–ª–µ–π**
   - –í `CreateAccountHandler`
   - –í `UpdateAccountHandler` (–µ—Å–ª–∏ –º–µ–Ω—è—é—Ç—Å—è —Ä–æ–ª–∏)

3. **–ò—Å–ø—Ä–∞–≤–∏—Ç—å —Å—Ä–∞–≤–Ω–µ–Ω–∏–µ –º–∞—Å—Å–∏–≤–æ–≤ —Ä–æ–ª–µ–π**
   - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π deep equality check

### –í–∞–∂–Ω—ã–µ (—Å–¥–µ–ª–∞—Ç—å –≤ –±–ª–∏–∂–∞–π—à–µ–µ –≤—Ä–µ–º—è)

4. **–î–æ–±–∞–≤–∏—Ç—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ**
   - –ù–µ—É–¥–∞—á–Ω—ã–µ –ø–æ–ø—ã—Ç–∫–∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
   - –°–æ–∑–¥–∞–Ω–∏–µ/–∏–∑–º–µ–Ω–µ–Ω–∏–µ –∞–¥–º–∏–Ω–æ–≤

5. **–£–¥–∞–ª–∏—Ç—å –Ω–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–π –∫–æ–¥**
   - `RolesGuard` (–µ—Å–ª–∏ –Ω–µ –ø–ª–∞–Ω–∏—Ä—É–µ—Ç—Å—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å)
   - `@RequireRoles` –¥–µ–∫–æ—Ä–∞—Ç–æ—Ä

6. **–î–æ–±–∞–≤–∏—Ç—å —Ç–µ—Å—Ç—ã**
   - Unit —Ç–µ—Å—Ç—ã –¥–ª—è authorization —Å–µ—Ä–≤–∏—Å–æ–≤
   - Integration —Ç–µ—Å—Ç—ã –¥–ª—è handlers

### –ñ–µ–ª–∞—Ç–µ–ª—å–Ω—ã–µ (–º–æ–∂–Ω–æ –æ—Ç–ª–æ–∂–∏—Ç—å)

7. **–†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ handlers**
   - –í—ã–Ω–µ—Å—Ç–∏ –æ–±—â—É—é –ª–æ–≥–∏–∫—É –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø—Ä–∞–≤
   - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å guard –≤–º–µ—Å—Ç–æ —Ä—É—á–Ω—ã—Ö –ø—Ä–æ–≤–µ—Ä–æ–∫

8. **–î–æ–±–∞–≤–∏—Ç—å Swagger –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é**

9. **–°–æ–∑–¥–∞—Ç—å —Å–∫—Ä–∏–ø—Ç –º–∏–≥—Ä–∞—Ü–∏–∏ –¥–∞–Ω–Ω—ã—Ö –∏–∑ —Å—Ç–∞—Ä–æ–≥–æ core**

---

## ‚úÖ –ò—Ç–æ–≥–æ–≤–∞—è –æ—Ü–µ–Ω–∫–∞

| –ö–∞—Ç–µ–≥–æ—Ä–∏—è | –û—Ü–µ–Ω–∫–∞ | –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π |
|-----------|--------|-------------|
| –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ | ‚≠ê‚≠ê‚≠ê‚≠ê (4/5) | –•–æ—Ä–æ—à–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞, –Ω–æ –µ—Å—Ç—å –Ω–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–π –∫–æ–¥ |
| –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å | ‚≠ê‚≠ê‚≠ê (3/5) | –ë–∞–∑–æ–≤–∞—è –∑–∞—â–∏—Ç–∞ –µ—Å—Ç—å, –Ω–æ –µ—Å—Ç—å —É—è–∑–≤–∏–º–æ—Å—Ç–∏ |
| –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è | ‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê (5/5) | –ü–æ–ª–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å —Å gateway/adminpanel |
| –ö–∞—á–µ—Å—Ç–≤–æ –∫–æ–¥–∞ | ‚≠ê‚≠ê‚≠ê‚≠ê (4/5) | –•–æ—Ä–æ—à–µ–µ, –Ω–æ –µ—Å—Ç—å –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ |
| –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ | ‚≠ê (1/5) | –ù–µ—Ç —Ç–µ—Å—Ç–æ–≤ –¥–ª—è –Ω–æ–≤—ã—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤ |
| –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è | ‚≠ê‚≠ê‚≠ê‚≠ê (4/5) | –•–æ—Ä–æ—à–∞—è, –Ω–æ –º–æ–∂–Ω–æ —É–ª—É—á—à–∏—Ç—å |

**–û–±—â–∞—è –æ—Ü–µ–Ω–∫–∞:** ‚≠ê‚≠ê‚≠ê‚≠ê (4/5)

**–í—ã–≤–æ–¥:** –ò–∑–º–µ–Ω–µ–Ω–∏—è —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã –∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω–æ, –Ω–æ —Ç—Ä–µ–±—É—é—Ç –¥–æ—Ä–∞–±–æ—Ç–∫–∏ –≤ —á–∞—Å—Ç–∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –ø–µ—Ä–µ–¥ production deployment.

---

## üîç –î–µ—Ç–∞–ª—å–Ω—ã–π –∞–Ω–∞–ª–∏–∑ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤

### GatewayAuthGuard

**–°–∏–ª—å–Ω—ã–µ —Å—Ç–æ—Ä–æ–Ω—ã:**
- –ü—Ä–æ—Å—Ç–∞—è –∏ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤
- –ì–ª–æ–±–∞–ª—å–Ω–∞—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è —á–µ—Ä–µ–∑ APP_GUARD

**–ü—Ä–æ–±–ª–µ–º—ã:**
- –ù–µ—Ç –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è –ø–æ–ø—ã—Ç–æ–∫ –¥–æ—Å—Ç—É–ø–∞
- –ù–µ—Ç rate limiting
- –ñ–µ—Å—Ç–∫–æ –∑–∞–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∏–º–µ–Ω–∞ –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:**
- –î–æ–±–∞–≤–∏—Ç—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
- –í—ã–Ω–µ—Å—Ç–∏ –∏–º–µ–Ω–∞ –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤ –≤ –∫–æ–Ω—Ñ–∏–≥

### AuthorizationService

**–°–∏–ª—å–Ω—ã–µ —Å—Ç–æ—Ä–æ–Ω—ã:**
- –ß–µ—Ç–∫–æ–µ API
- –ü–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ –º–µ—Ç–æ–¥—ã
- –°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ –ª–æ–≥–∏–∫–µ Symfony Voter'–æ–≤

**–ü—Ä–æ–±–ª–µ–º—ã:**
- –ú–µ—Ç–æ–¥ `canAccessAccount` –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è (–¥—É–±–ª–∏—Ä—É–µ—Ç—Å—è –≤ handlers)
- –ù–µ—Ç –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏—è –ø—Ä–æ–≤–µ—Ä–æ–∫

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:**
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `canAccessAccount` –≤ handlers –≤–º–µ—Å—Ç–æ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è
- –†–∞—Å—Å–º–æ—Ç—Ä–µ—Ç—å –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è —á–∞—Å—Ç–æ –ø—Ä–æ–≤–µ—Ä—è–µ–º—ã—Ö —Ä–æ–ª–µ–π

### JwtExtractorService

**–°–∏–ª—å–Ω—ã–µ —Å—Ç–æ—Ä–æ–Ω—ã:**
- –ò–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –ª–æ–≥–∏–∫–∞
- –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ (–≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç null)

**–ü—Ä–æ–±–ª–µ–º—ã:**
- –¢–µ—Ä—è–µ—Ç—Å—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ–± –æ—à–∏–±–∫–∞—Ö (–Ω–µ—Ç –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è)
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ —Ç–æ–ª—å–∫–æ `id` –∏ `sub` –ø–æ–ª–µ–π

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:**
- –î–æ–±–∞–≤–∏—Ç—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—à–∏–±–æ–∫
- –ü–æ–¥–¥–µ—Ä–∂–∞—Ç—å –∫–∞—Å—Ç–æ–º–Ω—ã–µ –ø–æ–ª—è –∏–∑ –∫–æ–Ω—Ñ–∏–≥–∞ (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ)

---

## üìå –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

–ò–∑–º–µ–Ω–µ–Ω–∏—è —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã –Ω–∞ —Ö–æ—Ä–æ—à–µ–º —É—Ä–æ–≤–Ω–µ –∏ –æ–±–µ—Å–ø–µ—á–∏–≤–∞—é—Ç:
- ‚úÖ –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –Ω–∞ —É—Ä–æ–≤–Ω–µ —Å–µ—Ç–∏ (gateway auth)
- ‚úÖ –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é –Ω–∞ —É—Ä–æ–≤–Ω–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è (role-based)
- ‚úÖ –ü–æ–ª–Ω—É—é —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å —Å —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–π —Å–∏—Å—Ç–µ–º–æ–π
- ‚úÖ –°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–µ –∏–∑ —Å—Ç–∞—Ä–æ–≥–æ core

**–û—Å–Ω–æ–≤–Ω—ã–µ —Ä–∏—Å–∫–∏:**
- –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ —Ç–µ—Å—Ç–æ–≤
- –ü–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–µ —É—è–∑–≤–∏–º–æ—Å—Ç–∏ –≤ –ø—É–±–ª–∏—á–Ω—ã—Ö endpoints
- –ù–µ—Ç –º–∏–≥—Ä–∞—Ü–∏–∏ –¥–∞–Ω–Ω—ã—Ö

**–†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è:**
1. –ò—Å–ø—Ä–∞–≤–∏—Ç—å –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ–±–ª–µ–º—ã –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
2. –î–æ–±–∞–≤–∏—Ç—å —Ç–µ—Å—Ç—ã
3. –ü—Ä–æ–≤–µ—Å—Ç–∏ security audit –ø–µ—Ä–µ–¥ production


